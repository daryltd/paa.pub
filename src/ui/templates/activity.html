<h1>Activity</h1>
{{#error}}
<div class="error">{{error}}</div>
{{/error}}

<div class="card">
  <h2>Compose</h2>
  <form method="POST" action="/compose">
    <div class="form-group">
      <textarea name="content" placeholder="What's on your mind?" required></textarea>
    </div>
    <div class="form-group">
      <label for="audience">Audience</label>
      <select name="audience" id="audience">
        <option value="public">Public</option>
        <option value="unlisted">Unlisted</option>
        <option value="followers">Followers Only</option>
        <option value="private">Private</option>
      </select>
    </div>
    <div class="form-group">
      <input type="text" name="summary" placeholder="Content warning (optional)">
    </div>
    <button type="submit" class="btn">Post</button>
  </form>
</div>

{{#hasPendingRequests}}
<div class="card">
  <h2>Follow Requests ({{pendingCount}})</h2>
  <ul style="list-style: none; padding: 0;">
    {{#pendingRequests}}
    <li style="display: flex; align-items: center; gap: 0.5rem; padding: 0.4rem 0; border-bottom: 1px solid #eee;">
      <span class="mono" style="flex: 1; font-size: 0.8rem; overflow: hidden; text-overflow: ellipsis;">{{actor}}</span>
      <span class="text-muted" style="font-size: 0.75rem; white-space: nowrap;">{{receivedAt}}</span>
      <form method="POST" action="/follow-requests/accept" class="inline">
        <input type="hidden" name="target" value="{{actor}}">
        <button type="submit" class="btn" style="padding: 0.15rem 0.5rem; font-size: 0.75rem;">Accept</button>
      </form>
      <form method="POST" action="/follow-requests/reject" class="inline">
        <input type="hidden" name="target" value="{{actor}}">
        <button type="submit" class="btn btn-secondary" style="padding: 0.15rem 0.5rem; font-size: 0.75rem;">Reject</button>
      </form>
    </li>
    {{/pendingRequests}}
  </ul>
</div>
{{/hasPendingRequests}}

<div class="card">
  <h2>Follow / Unfollow</h2>
  <form method="POST" action="/follow" style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
    <input type="text" name="target" placeholder="user@domain.com or actor URL" style="flex: 1;">
    <button type="submit" class="btn">Follow</button>
  </form>
  {{#hasFollowing}}
  <details>
    <summary class="text-muted">{{followingCount}} following</summary>
    <ul style="list-style: none; padding: 0; margin-top: 0.5rem;">
      {{#following}}
      <li style="display: flex; align-items: center; gap: 0.5rem; padding: 0.25rem 0;">
        <a href="{{feedUrl}}" class="mono" style="flex: 1; font-size: 0.8rem; overflow: hidden; text-overflow: ellipsis;">{{uri}}</a>
        <form method="POST" action="/unfollow" class="inline">
          <input type="hidden" name="target" value="{{uri}}">
          <button type="submit" class="btn btn-secondary" style="padding: 0.15rem 0.5rem; font-size: 0.75rem;">Unfollow</button>
        </form>
      </li>
      {{/following}}
    </ul>
  </details>
  {{/hasFollowing}}
  {{#hasFollowers}}
  <details style="margin-top: 0.5rem;">
    <summary class="text-muted">{{followerCount}} followers</summary>
    <ul style="list-style: none; padding: 0; margin-top: 0.5rem;">
      {{#followers}}
      <li style="padding: 0.25rem 0;">
        <a href="{{feedUrl}}" class="mono" style="font-size: 0.8rem; overflow: hidden; text-overflow: ellipsis;">{{uri}}</a>
      </li>
      {{/followers}}
    </ul>
  </details>
  {{/hasFollowers}}
</div>

<div>
  <h2>Feed <span class="text-muted" style="font-size: 0.85rem; font-weight: normal;">(latest {{feedLimit}})</span></h2>
  {{^hasActivities}}
  <div class="card text-muted">No activities yet.</div>
  {{/hasActivities}}
  {{#activities}}
  <div class="card">
    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
      <span class="mono" style="font-size: 0.8rem;">{{actor}}</span>
      <span class="text-muted">{{published}}</span>
    </div>
    <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
      <span style="background: #e8e8e8; padding: 0.1rem 0.4rem; border-radius: 3px; font-size: 0.75rem;">{{type}}</span>
      <span style="background: {{{sourceColor}}}; padding: 0.1rem 0.4rem; border-radius: 3px; font-size: 0.75rem;">{{source}}</span>
    </div>
    {{#isCreate}}
      {{#hasSummary}}<div class="text-muted"><em>CW: {{summary}}</em></div>{{/hasSummary}}
      <div>{{{content}}}</div>
    {{/isCreate}}
    {{#isFollow}}
      <div class="text-muted">Follow â†’ {{target}}</div>
    {{/isFollow}}
    {{#isAccept}}
      <div class="text-muted">Accepted activity</div>
    {{/isAccept}}
    {{#isUndo}}
      <div class="text-muted">Undid activity</div>
    {{/isUndo}}
    {{#isOther}}
      <div class="text-muted">{{type}} activity</div>
    {{/isOther}}
  </div>
  {{/activities}}
</div>
